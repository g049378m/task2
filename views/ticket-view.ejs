<%- include("partials/header") %>
<%- include("partials/nav") %>

<h2>Your Ticket</h2>

<p><strong>Visit Date:</strong> <%= ticket.visitDate %></p>
<p><strong>Total Price:</strong> £<%= ticket.totalPrice.toFixed(2) %></p>
<p><strong>Fast-Track Rides:</strong>
  <% if (ticket.fastTrackRides.length > 0) { %>
    <ul>
      <% ticket.fastTrackRides.forEach((ride) => { %>
        <li><%= ride.name %></li>
      <% }) %>
    </ul>
  <% } else { %>
    None added yet.
  <% } %>
</p>
<hr>
<% 
  const today = new Date().toISOString().split("T")[0]; 
  const editable = ticket.status === "draft" && ticket.visitDate > today;
%>

<% if (editable) { %>
  <h3>Add a Fast-Track Ride</h3>
  <form method="post" action="/tickets/<%= ticket._id %>/add-ride">
    <select name="rideName" required>
      <% rides.forEach((ride) => { %>
        <option value="<%= ride.name %>">
          <%= ride.name %> (£<%= ride.fastTrackPrice.toFixed(2) %>)
        </option>
      <% }) %>
    </select>
    <input type="submit" value="Add Ride">
  </form>
<% } else { %>
  <p><em>You cannot add rides to this ticket anymore.</em></p>
<% } %>

<p><strong>Status:</strong> <%= ticket.status %></p>

<% if (ticket.status === "draft") { %>
  <form method="post" action="/tickets/<%= ticket._id %>/confirm">
    <input type="submit" value="Confirm Purchase">
  </form>
<% } else { %>
  <p>This ticket has been purchased.</p>
<% } %>



<%- include("partials/footer") %>
